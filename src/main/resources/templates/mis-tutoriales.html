<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Mis Tutoriales - BedroomGameDev</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/dark-theme.css" rel="stylesheet">
</head>
<body>
    <div th:replace="fragments :: navbar('mis-tutoriales')"></div>

    <div class="separador1"></div>

    <div class="container mt-4">
        <h1 class="text-center mb-2 texto-brillante">Mis Tutoriales</h1>

        <div class="separador1"></div>

        <p class="text-center text-white mb-4">Bienvenido, <span th:text="${usuario.nombre()}"></span></p>
        
        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
        
        <!-- Formulario para crear nuevo tutorial -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Crear Nuevo Tutorial</h5>
            </div>
            <div class="card-body">
                <form th:action="@{/mis-tutoriales/{id}/crear(id=${usuario.id()})}" method="post">
                    <div class="mb-3">
                        <label for="titulo" class="form-label">Título:</label>
                        <input type="text" class="form-control" id="titulo" name="titulo" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="imagen" class="form-label">URL de Imagen (máximo 500 caracteres):</label>
                        <input type="url" class="form-control" id="imagen" name="imagen" maxlength="500" placeholder="https://ejemplo.com/imagen.jpg">
                        <div class="form-text text-white">Usa URLs cortas y directas de imágenes</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="descripcion" class="form-label">Descripción breve:</label>
                        <textarea class="form-control" id="descripcion" name="descripcion" rows="3" placeholder="Descripción corta del tutorial"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="cuerpo" class="form-label">Contenido del tutorial:</label>
                        <textarea class="form-control" id="cuerpo" name="cuerpo" rows="6" required placeholder="Escribe aquí el contenido completo del tutorial..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-success">Crear Tutorial</button>
                </form>
            </div>
        </div>
        
        <!-- Lista de tutoriales -->
        <h5 class="mb-3">Mis Tutoriales Creados</h5>
        
        <div th:if="${#lists.isEmpty(tutoriales)}" class="text-center py-4 text-muted">
            No has creado ningún tutorial aún.
        </div>
        
        <div th:if="${!#lists.isEmpty(tutoriales)}" class="table-responsive">
            <table class="table table-dark table-striped rounded-3 overflow-hidden">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Título</th>
                        <th>Descripción</th>
                        <th>Imagen</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="tutorial : ${tutoriales}">
                        <td th:text="${tutorial.id()}"></td>
                        <td th:text="${tutorial.titulo()}"></td>
                        <td th:text="${tutorial.descripcion()}"></td>
                        <td>
                            <img th:if="${tutorial.imagen() != null and !tutorial.imagen().isEmpty()}" 
                                 th:src="${tutorial.imagen()}" alt="Imagen" class="img-thumbnail" style="width: 50px; height: 50px; object-fit: cover;">
                            <span th:if="${tutorial.imagen() == null or tutorial.imagen().isEmpty()}" class="text-muted">Sin imagen</span>
                        </td>
                        <td>
                            <a th:href="@{/mis-tutoriales/{userId}/editar/{tutorialId}(userId=${usuario.id()}, tutorialId=${tutorial.id()})}" 
                               class="btn btn-warning btn-sm me-2">Editar</a>
                            
                            <form method="post" 
                                  th:action="@{/mis-tutoriales/{userId}/eliminar/{tutorialId}(userId=${usuario.id()}, tutorialId=${tutorial.id()})}" 
                                  style="display: inline;" 
                                  onsubmit="return confirm('¿Estás seguro de eliminar este tutorial?')">
                                <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div th:replace="fragments :: footer"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>